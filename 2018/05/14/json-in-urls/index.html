<!DOCTYPE html>
<html lang="">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="「译」在 URLs 中使用 JSON"/>




  <meta name="keywords" content="Web," />





  <link rel="alternate" href="/atom.xml" title="WANG!">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1" />



<link rel="canonical" href="https://hiwangzi.com/2018/05/14/json-in-urls/"/>


<meta name="description" content="原文地址：JSON in URLs | Dropbox Developer Blog  基于 HTTP 的 API 经常将参数编码为 URL 路径或查询参数。例如，调用丢丢盒（Dropbox）API 搜索文件名时的路径可能如下所示： 1/1/search/auto/My+Documents?query=draft+2013 虽然对于简单的例子而言，使用 URL 编码似乎已经足够完美，但使用 JS">
<meta name="keywords" content="Web">
<meta property="og:type" content="article">
<meta property="og:title" content="「译」在 URLs 中使用 JSON">
<meta property="og:url" content="https://hiwangzi.com/2018/05/14/json-in-urls/index.html">
<meta property="og:site_name" content="WANG!">
<meta property="og:description" content="原文地址：JSON in URLs | Dropbox Developer Blog  基于 HTTP 的 API 经常将参数编码为 URL 路径或查询参数。例如，调用丢丢盒（Dropbox）API 搜索文件名时的路径可能如下所示： 1/1/search/auto/My+Documents?query=draft+2013 虽然对于简单的例子而言，使用 URL 编码似乎已经足够完美，但使用 JS">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2018-05-15T10:56:25.957Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="「译」在 URLs 中使用 JSON">
<meta name="twitter:description" content="原文地址：JSON in URLs | Dropbox Developer Blog  基于 HTTP 的 API 经常将参数编码为 URL 路径或查询参数。例如，调用丢丢盒（Dropbox）API 搜索文件名时的路径可能如下所示： 1/1/search/auto/My+Documents?query=draft+2013 虽然对于简单的例子而言，使用 URL 编码似乎已经足够完美，但使用 JS">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1" />
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>


  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />




<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: true
    },
  };
</script>




  



    <title> 「译」在 URLs 中使用 JSON - WANG! </title>
  </head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">WANG!</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/atom.xml">
                            
                            
                                RSS
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          「译」在 URLs 中使用 JSON
        
      </h1>

      <time class="post-time">
          May 14 2018
      </time>
    </header>



    
            <div class="post-content">
            <blockquote>
<p>原文地址：<a href="https://blogs.dropbox.com/developers/2015/03/json-in-urls/" target="_blank" rel="noopener">JSON in URLs | Dropbox Developer Blog</a></p>
</blockquote>
<p>基于 HTTP 的 API 经常将参数编码为 URL 路径或查询参数。例如，调用丢丢盒（Dropbox）API 搜索文件名时的路径可能如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/1/search/auto/My+Documents?query=draft+2013</span><br></pre></td></tr></table></figure>
<p>虽然对于简单的例子而言，使用 URL 编码似乎已经足够完美，但使用 JSON 可能也有一些优点。</p>
<h2 id="混乱的-URL-路径"><a href="#混乱的-URL-路径" class="headerlink" title="混乱的 URL 路径"></a>混乱的 URL 路径</h2><p>在上面的例子中，因为第一个 <code>+</code> 就在 URL 之中，所以其就是字面意义上的加号。而第二个 <code>+</code> 表示一个空格，因为它位于 URL 查询部分。这两者很容易混淆，因为他们的编码规则在大多数情况下是相同的，而且就像 <code>urlencode</code> 一样，有时一些库提供的函数的名字又非常模棱两可。我们 SDK 的一个早期版本就因此有过一个 bug。</p>
<p>另一个常见的错误就是误认为在路径部分 <code>/</code> 同其他普通字符一样。</p>
<ul>
<li><code>/hello-world</code> 等价于 <code>/hello%2Dworld</code></li>
<li><code>/hello/world</code> <strong>不</strong>等价于 <code>/hello%2Fworld</code></li>
</ul>
<p>符号 <code>/</code> 是保留的分界符。将其改为使用 <code>%</code> 编码的形式会改变 URL 的含义。大多数 URL 编码库并没有非常清晰地对两者作出区分。虽然大多数情况下这不重要，<a href="https://sakurity.com/blog/2015/03/15/authy_bypass.html" target="_blank" rel="noopener">但某些情况却非常关键</a>。</p>
<h2 id="URL-查询参数表现力不足"><a href="#URL-查询参数表现力不足" class="headerlink" title="URL 查询参数表现力不足"></a>URL 查询参数表现力不足</h2><p>假设 API 参数需要一组值时，该怎么处理呢？一些 API 可能使用逗号或重复的名字来处理。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/docs/salary.csv?columns=1,2</span><br><span class="line">/docs/salary.csv?column=1&amp;column=2</span><br></pre></td></tr></table></figure>
<p>对于嵌套的字段，一些 API 可能如下处理：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/emails?from[name]=Don&amp;from[date]=1998-03-24&amp;to[name]=Norm</span><br></pre></td></tr></table></figure>
<p>这些变通都是合理的，但他们仍然只是变通之举。并没有普遍的标准。但 JSON 可以一致、简单的处理嵌套。</p>
<h2 id="使用-URL-编码是否很糟糕呢？"><a href="#使用-URL-编码是否很糟糕呢？" class="headerlink" title="使用 URL 编码是否很糟糕呢？"></a>使用 URL 编码是否很糟糕呢？</h2><p>不，它只是为不同的情况设计的：人类交互使用。</p>
<p>JSON 将一切字符串用引号包裹。这让许多事情变得更简单以及更健壮，但对于人们来说，读与写可能略显乏味单调。</p>
<p>相较于 JSON，URL 参数可以更快的开始使用。在通常情况下，这非常不错。但缺点就是更容易造成混乱，因此任何处理 URL 参数的代码都会变得很复杂。</p>
<p>这里要做一些合理的权衡。 我不会在我的浏览器地址栏使用 JSON，但对于基于 HTTP 的 API 来说，使用 JSON 来处理可能是一个更好的选择。</p>
<h2 id="所以问题在哪儿呢？"><a href="#所以问题在哪儿呢？" class="headerlink" title="所以问题在哪儿呢？"></a>所以问题在哪儿呢？</h2><p>当思考到这的时候，我们可以说对比于 URL 编码，使用 JSON 在某些方面更佳。对于结构化的数据，HTTP API 响应已经基本上都在使用 JSON 了。最近一次我处理 URL 编码的响应体是在 2007 年时使用 OAuth 1。目前 OAuth 2 已经使用 JSON 了。</p>
<p>API 请求体分裂成了 JSON 和 URL 编码两种形式。URL 编码的一个好处是<a href="https://stripe.com/docs/api/curl#create_charge" target="_blank" rel="noopener">你可以很好的使用 <code>curl</code> 命令行工具做示例</a>。但很多 API，包括丢丢盒新一些的 API，已经开始在请求体中使用 JSON。</p>
<p>所以为什么不在 URL 中同样使用 JSON 呢？就像下面这样：</p>
<ul>
<li>URL encoded: <code>/log?a=b&amp;c=4</code></li>
<li>JSON in URL: <code>/log?%7B%22a%22:%22b%22,%22c%22:4%7D</code></li>
</ul>
<p>第一点，JSON 形式更长了。这可能会导致你的 URL 超出<a href="https://stackoverflow.com/questions/417142/what-is-the-maximum-length-of-a-url-in-different-browsers/417184#417184" target="_blank" rel="noopener">长度限制</a>。</p>
<p>同时，它看起来很丑，但这可以通过抽象来解决。例如，除非在 packet 层面上出现了错误，否则你也无需去处理原始网络 packet。同样的道理，除非你的 URL 出现错误，否则你无需去接触丑陋版本的 URL。一旦它通过了检测，你在错误消息或日志输出中看到的就只是解码过的字符串了。</p>
<p>创建一个整理抽象层需要花费额外的工作，尤其过去从未使用过类似方式。虽然在 URL 中使用 JSON 前期会有一些烦恼，但它带来的好处值得让人一试。</p>

            </div>
          

    
      <footer class="post-footer">
		
		<div class="post-tags">
		  
			<a href="/tags/Web/">Web</a>
		  
		</div>
		

        
        
  <nav class="post-nav">
    
    
      <a class="next" href="/2018/05/08/difference-between-if-a-b-0-and-if-a-b/">
        <span class="next-text nav-default">「译」if(a-b&lt;0) 与 if(a&lt;b) 的区别</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
    <div style="text-align:center;">
        <button class="btn" id="load-disqus" onclick="disqus.load();">加载 Disqus 评论</button>
    </div>
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
    2018
    <span class="footer-author">zill057.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a> and <a class="theme-link" href="https://github.com/frostfan/hexo-theme-polarbear">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    

<script type="text/javascript">
  var disqus_shortname = 'zill';
  var disqus_identifier = '2018/05/14/json-in-urls/';

  var disqus_title = "「译」在 URLs 中使用 JSON";


  var disqus = {
    load : function disqus(){
        if(typeof DISQUS !== 'object') {
          (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
          }());
          $('#load-disqus').remove(); ///加载后移除按钮
        }
    }
  }

  
    var disqus_config = function () {
        this.page.url = disqus_url;
        this.page.identifier = disqus_identifier;
        this.page.title = disqus_title;
    };
  

</script>


    
  





  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
