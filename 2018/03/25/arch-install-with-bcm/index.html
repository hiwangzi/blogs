<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>安装Arch中遇到的Broadcom b43(BCM43228)网卡问题 | WANG!</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">安装Arch中遇到的Broadcom b43(BCM43228)网卡问题</h1><a id="logo" href="/.">WANG!</a><p class="description">道且长，衣衫薄</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">安装Arch中遇到的Broadcom b43(BCM43228)网卡问题</h1><div class="post-meta">Mar 25, 2018</div><a class="disqus-comment-count" data-disqus-identifier="2018/03/25/arch-install-with-bcm/" href="/2018/03/25/arch-install-with-bcm/#disqus_thread"></a><div class="post-content"><p>之前按照<a href="https://www.viseator.com/2017/05/17/arch_install/" target="_blank" rel="noopener">以官方Wiki的方式安装ArchLinux</a>，并结合<a href="https://wiki.archlinux.org/index.php/installation_guide" target="_blank" rel="noopener">官方文档</a>，成功的在VirtualBox环境下安装好了Arch。虚拟机限于内存、显卡等，体验不够好，因此今天准备在旧笔记本实机安装。在第一步联网过程中，就遇到了阻碍，特此记录。</p>
<h2 id="查看网卡类型"><a href="#查看网卡类型" class="headerlink" title="查看网卡类型"></a>查看网卡类型</h2><p>在之前的虚拟机环境下，采用NAT模式联网，网卡自动识别并加载，只需要执行 <code>dhcpcd</code> 获取 IP 后即可成功连接互联网。但这次，系统并不能自动驱动硬件工作，所以我们需要先检查一下网卡类型。</p>
<ul>
<li><p>执行 <code>lspci -k</code> 查看 <code>Network controller</code> 这一项。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">02:00.0 Network controller: Broadcom Limited BCM43228 802.11a/b/g/n</span><br><span class="line">Subsystem: Foxconn International, Inc. BCM43228 802.11a/b/g/n</span><br><span class="line">Kernel driver in use: bcma-pci-bridge</span><br><span class="line">Kernel moudles: bcma</span><br></pre></td></tr></table></figure>
</li>
<li><p>检查 <code>ip link</code> 输出结果中有没有 <code>wlan0</code> 或 <code>wlps21</code> 一类的设备。如果有的话，只需要执行 <code>ip link set &lt;设备名&gt; up</code> 即可，无需再额外安装驱动程序。</p>
</li>
<li><p>如果没有，即需要检查内核的固件信息 <code>dmesg | grep firmware</code>，获得更多提示</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b43-phy0 ERROR: You must go to http://wireless.kernel.or/en/users/Drivers/b43#devicefirmware and download the correct firmware for this driver version.</span><br></pre></td></tr></table></figure>
<ul>
<li>如果没有这样的信息，可以先尝试执行 <code>iwlwifi</code> 一类命令，然后查找对应的错误信息 <code>dmesg | grep iwlwifi</code></li>
<li>获得提示信息后，例如上面的网站，可以访问后，获得进一步的信息。此处需要执行 <code>lspci -nn -d 14e4:</code> 获得详细的硬件型号，并下载<a href="https://aur.archlinux.org/packages/b43-firmware/" target="_blank" rel="noopener">对应的驱动</a>。关于博通无线网卡，可以查阅 <a href="https://wiki.archlinux.org/index.php/Broadcom_wireless_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87" target="_blank" rel="noopener">Wiki 页面</a>)获得更多信息。</li>
</ul>
</li>
</ul>
<h2 id="下载并安装驱动"><a href="#下载并安装驱动" class="headerlink" title="下载并安装驱动"></a>下载并安装驱动</h2><ul>
<li>没网络怎么下载 ❓ 可以下载至安装U盘的根目录，安装时切换至 <code>/run/archiso/bootmnt</code>，即可看到下载的内容，将其拷贝至 <code>/root</code> 解压。</li>
<li>怎么安装驱动 ❓ <a href="https://www.cnblogs.com/clouds008/p/7460928.html" target="_blank" rel="noopener">更多参考</a> 在上一步解压完成后，会得到一个 <code>.o</code> 结尾的问题，执行 <code>b43-fwcutter -w /lib/firmware xxx.o</code> 即可完成安装。</li>
<li><p>安装后怎么启动 ❓ <a href="http://linuxwireless.sipsolutions.net/en/users/Drivers/b43/" target="_blank" rel="noopener">更多参考</a> 卸载之前的驱动，然后再加载新安装的驱动。</p>
<ul>
<li><p>卸载旧驱动（如果你知道你正在使用的驱动名称的话，只需执行对应的命令即可）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">modprobe -r b43 bcma</span><br><span class="line">modprobe -r brcmsmac bcma</span><br><span class="line">modprobe -r wl</span><br></pre></td></tr></table></figure>
</li>
<li><p>加载新驱动（只需执行对应的驱动命令即可）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">modprobe b43</span><br><span class="line">modprobe brcmsmac</span><br><span class="line">modprobe wl</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>安装完成后可以通过 <code>ip link</code> 查看是否有新增加的网络接口信息。</p>
</li>
</ul>
<h2 id="安装完成后的联网过程"><a href="#安装完成后的联网过程" class="headerlink" title="安装完成后的联网过程"></a>安装完成后的联网过程</h2><blockquote>
<p>此部分内容主要参考了 <a href="https://linux.cn/article-4015-1.html" target="_blank" rel="noopener">在命令行中管理 Wifi 连接</a></p>
</blockquote>
<ul>
<li>通过 <code>ip link set &lt;设备名&gt; up</code> 启动接口服务。</li>
<li>可以通过 <code>iw dev &lt;设备名&gt; scan | less</code> 扫描附近网络。</li>
<li><p>联网</p>
<ul>
<li><p>无加密网络</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iw dev &lt;设备名&gt; connect &lt;网络 SSID&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>WEP 加密</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iw dev &lt;设备名&gt; connect &lt;网络 SSID&gt; key 0:&lt;WEP密钥&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>WPA/WPA2 加密（现在最常见）</p>
<ul>
<li><p><code>vim /etc/wpasupplicant/wpa_supplicant.conf</code> 编辑文件（其实放在别的位置也行），增加如下内容（注意包含引号）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">network=&#123;</span><br><span class="line">    ssid=&quot;&lt;网络 SSID&gt;&quot;</span><br><span class="line">    psk=&quot;&lt;密码&gt;&quot;</span><br><span class="line">    priority=1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>wpa_supplicant -i &lt;设备名&gt; -c /etc/wpa_supplicant/wpa_supplicant.conf &amp;</code> 后台启动网络连接</p>
</li>
</ul>
</li>
</ul>
</li>
<li>获取 IP：<code>dhcpcd &lt;设备名&gt;</code> 自动获取 IP 地址</li>
<li>测试网络：<code>ping hiwangzi.com</code> 测试网络连接是否正常~</li>
</ul>
</div><div class="tags"><a href="/tags/Linux/">Linux</a></div><div class="post-nav"><a class="next" href="/2018/02/03/what-is-unix/">什么是 Unix</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论 「请确保 disqus.com 可以正常加载」</button></div><script>var disqus_shortname = 'zill';
var disqus_identifier = '2018/03/25/arch-install-with-bcm/';
var disqus_title = '安装Arch中遇到的Broadcom b43(BCM43228)网卡问题';
var disqus_url = 'http://hiwangzi.com/2018/03/25/arch-install-with-bcm/';
$('.btn_click_load').click(function() {
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  $('.btn_click_load').css('display','none');
});
$.ajax({
  url: 'https://disqus.com/next/config.json',
  timeout: 3000,
  type: 'GET',
  success: (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    $('.btn_click_load').css('display','none');
  })(),
  error: function() {
    $('.btn_click_load').css('display','block');
  }
});</script><script id="dsq-count-scr" src="//zill.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://hiwangzi.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/生活/" style="font-size: 15px;">生活</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/03/25/arch-install-with-bcm/">安装Arch中遇到的Broadcom b43(BCM43228)网卡问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/03/what-is-unix/">什么是 Unix</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/31/october-2016/">我的十月</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//zill.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">WANG!.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>