<!DOCTYPE html>
<html lang="en-us">
    <head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<title>
				「译」if(a - b &lt; 0) 与 if(a &lt; b) 的区别 &middot; WANG!
		</title>

		
  		<link rel="stylesheet" href="/blogs/css/style.css">
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">
		
		<link rel="icon" type="image/png" sizes="32x32" href="/blogs/images/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/blogs/images/favicon-16x16.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/blogs/images/apple-touch-icon.png">

		
		<link href="" rel="alternate" type="application/rss+xml" title="WANG!" />
	</head>

    <body>
        		<nav class="nav">
			<div class="nav-container">
				<a href="/blogs/">
					<h2 class="nav-title">WANG!</h2>
				</a>
				<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/rainbow.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<ul>
    <li><a href="/blogs/tags">Tags</a></li>
    <li><a href="/blogs/about">About</a></li>
    <li><a href="/blogs/index.xml">RSS</a></li>
</ul>
			</div>
		</nav>

        

<main>
	<div class="post">
		<div class="post-info">
    <span>Written by</span>
        
        <br>
        <span>on&nbsp;</span><time datetime="2018-05-08 00:00:00 &#43;0800 CST">May 8, 2018</time>
</div>
		<h1 class="post-title">「译」if(a - b &lt; 0) 与 if(a &lt; b) 的区别</h1>
<div class="post-line"></div>

		

		

<h2 id="目录">目录</h2>

<ul>
<li><a href="#问题">问题</a></li>
<li><a href="#赞同最多的回答">赞同最多的回答</a></li>
</ul>

<blockquote>
<p>原文地址：<a href="https://stackoverflow.com/questions/33147339/difference-between-if-a-b-0-and-if-a-b">java - Difference between if (a - b &lt; 0) and if (a &lt; b) - Stack Overflow</a></p>
</blockquote>

<h2 id="问题">问题</h2>

<p>在阅读 Java 的 <code>ArrayList</code> 源代码时，我注意到在 <code>if</code> 语句中的一些比较语句。</p>

<p>在 Java 7 之中，<a href="http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/7-b147/java/util/ArrayList.java#ArrayList.grow%28int%29"><code>grow(int)</code></a> 方法使用了如下代码：</p>

<pre><code class="language-java">if (newCapacity - minCapacity &lt; 0)
    newCapacity = minCapacity;
</code></pre>

<p>在 Java 6 中，没有 <code>grow</code> 方法。但方法 <a href="http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/6-b27/java/util/ArrayList.java#ArrayList.ensureCapacity%28int%29"><code>ensureCapacity(int)</code></a> 却使用如下方式比较数值：</p>

<pre><code class="language-java">if (newCapacity &lt; minCapacity)
    newCapacity = minCapacity;
</code></pre>

<p>变更比较语句写法的原因是什么呢？为了性能还是说只是代码风格的变化？</p>

<p>我可以理解，与 0 作比较速度更快，但同时却需多执行一个减法，这不是额外的开销吗？同时对于编译后的字节码来说，做差比较需要涉及两个指令（<code>ISUB</code> 和 <code>IF_ICMPGE</code>），而直接比较只需要涉及 <code>IFGE</code> 一条指令。</p>

<h2 id="赞同最多的回答">赞同最多的回答</h2>

<p><code>a &lt; b</code> 与 <code>a - b &lt; 0</code> 可以表示不同的含义。</p>

<p>考虑如下场景：</p>

<pre><code class="language-java">int a = Integer.MAX_VALUE;
int b = Integer.MIN_VALUE;
if (a &lt; b) {
    System.out.println(&quot;a &lt; b&quot;);
}
if (a - b &lt; 0) {
    System.out.println(&quot;a - b &lt; 0&quot;);
}
</code></pre>

<p>执行结果是：只会打印 <code>a - b &lt; 0</code>。因为 <code>a &lt; b</code> 显然是 false，但 <code>a - b</code> 产生了溢出，结果是 <code>-1</code>，因此结果为 true。</p>

<ul>
<li>译者注：
<code>java
int max = Integer.MAX_VALUE; //  2147483647
int min = Integer.MIN_VALUE; // -2147483648
</code></li>
</ul>

<p>说回问题本身，我们假设数组长度本身已经非常接近于 <code>Integer.MAX_VALUE</code> 来看一看。<code>ArrayList</code> 之中的代码如下：</p>

<pre><code class="language-java">// 译者注：可以查看问题中的第一个链接 grow(int) 方法
int oldCapacity = elementData.length;
int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1);
if (newCapacity - minCapacity &lt; 0)
    newCapacity = minCapacity;
if (newCapacity - MAX_ARRAY_SIZE &gt; 0)
    newCapacity = hugeCapacity(minCapacity);
</code></pre>

<p><code>oldCapacity</code> 非常接近 <code>Integer.MAX_VALUE</code>，因此 <code>newCapacity</code>（即<code>oldCapacity + 0.5 * oldCapacity</code>）有可能产生溢出，假设溢出后值为 <code>Integer.MIN_VALUE</code> (负值)。然后，减去 <code>minCapacity</code> 又<strong>下溢</strong>变为正值（译者注：假设参数<code>minCapacity</code>为正值）。</p>

<p>因此第一个 <code>if</code> 块中的代码将不会被执行。但假设代码条件写作 <code>if (newCapacity &lt; minCapacity)</code>，结果将会是 <code>true</code>（因为 <code>newCapacity</code> 是负值），这将导致 <code>newCapacity</code> 被强行指定为 <code>minCapacity</code> 而没有考虑 <code>minCapacity</code>。</p>

<p>这个溢出问题将会被下一个 <code>if</code> 语句所处理。当 <code>newCapacity</code> 溢出后，此 <code>if</code> 的结果为 <code>true</code>：<code>MAX_ARRAY_SIZE</code> 为 <code>Integer.MAX_VALUE - 8</code>，所以 <code>Integer.MIN_VALUE - (Integer.MAX_VALUE - 8) &gt; 0</code> 为 <code>true</code>。因此 <code>newCapacity</code> 可以被正确的处理：<code>hugeCapacity</code> 方法将返回 <code>MAX_ARRAY_SIZE</code> 或 <code>Integer.MAX_VALUE</code>。</p>

<p>注意：这就是对应 Java 代码中注释 <code>// overflow-conscious</code> 的含义。</p>


		<div>
<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "zill" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

	</div>

	<div class="pagination">
		<a href="/blogs/posts/arch-install-with-bcm/" class="left arrow">&#8592;</a>
		<a href="/blogs/posts/json-in-urls/" class="right arrow">&#8594;</a>

		<a href="#" class="top">Top</a>
	</div>
</main>


        		<footer>
			<span>
			&copy; <time datetime="2019-04-17 17:10:21.241032 &#43;0800 CST m=&#43;0.052831956">2019</time> zill057. Made with <a href='https://gohugo.io'>Hugo</a> using the <a href='https://github.com/EmielH/tale-hugo/'>Tale</a> theme.
			</span>
		</footer>

    </body>
</html>
