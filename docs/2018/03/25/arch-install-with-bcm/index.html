<!DOCTYPE html>
<html lang="en-us">
    <head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<title>
				安装 Arch 中遇到的 Broadcom b43(BCM43228) 网卡问题 &middot; WANG!
		</title>

		
  		<link rel="stylesheet" href="/css/style.css">
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">
		
		<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

		
		<link href="" rel="alternate" type="application/rss+xml" title="WANG!" />
	</head>

    <body>
        		<nav class="nav">
			<div class="nav-container">
				<a href="/">
					<h2 class="nav-title">WANG!</h2>
				</a>
				<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/rainbow.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<ul>
    <li><a href="/tags">Tags</a></li>
    <li><a href="/about">About</a></li>
    <li><a href="/index.xml">RSS</a></li>
</ul>
			</div>
		</nav>

        

<main>
	<div class="post">
		<div class="post-info">
    <span>Written by</span>
        
        <br>
        <span>on&nbsp;</span><time datetime="2018-03-25 00:00:00 &#43;0800 CST">March 25, 2018</time>
</div>
		<h1 class="post-title">安装 Arch 中遇到的 Broadcom b43(BCM43228) 网卡问题</h1>
<div class="post-line"></div>

		

		

<p>之前按照以 <a href="https://www.viseator.com/2017/05/17/arch_install/">官方 Wiki 的方式安装 ArchLinux</a>，并结合 <a href="https://wiki.archlinux.org/index.php/installation_guide">官方文档</a>，成功的在 VirtualBox 环境下安装好了 Arch。虚拟机限于内存、显卡等因素，体验不够好，因此今天准备在旧笔记本实机安装。在第一步联网过程中，就遇到了阻碍，特此记录。</p>

<h2 id="查看网卡类型">查看网卡类型</h2>

<p>在之前的虚拟机环境下，采用 NAT 模式联网，网卡自动识别并加载，只需要执行 <code>dhcpcd</code> 获取 IP 后即可成功连接互联网。但这次，系统并不能自动驱动硬件工作，所以我们需要先检查一下网卡类型。</p>

<ul>
<li><p>执行 <code>lspci -k</code> 查看 Network controller 这一项。</p>

<pre><code>02:00.0 Network controller: Broadcom Limited BCM43228 802.11a/b/g/n
Subsystem: Foxconn International, Inc. BCM43228 802.11a/b/g/n
Kernel driver in use: bcma-pci-bridge
Kernel moudles: bcma
</code></pre></li>

<li><p>检查 <code>ip link</code> 输出结果中有没有 <code>wlan0</code> 或 <code>wlps21</code> 一类的设备。如果有的话，只需要执行 <code>ip link set &lt;设备名&gt; up</code> 即可，无需再额外安装驱动程序。</p></li>

<li><p>如果没有，即需要检查内核的固件信息 <code>dmesg | grep firmware</code>，得到更多提示</p>

<pre><code>b43-phy0 ERROR: You must go to http://wireless.kernel.or/en/users/Drivers/b43#devicefirmware and download the correct firmware for this driver version.
</code></pre>

<ul>
<li>如果没有这样的信息，可以先尝试执行 <code>iwlwifi</code> 一类命令，然后查找对应的错误信息 <code>dmesg | grep iwlwifi</code></li>
<li>获得提示信息后，例如上面的网站，可以访问得到进一步的信息。此处根据上述 <code>ERROR</code> 中的网站给出的指导，执行 <code>lspci -nn -d 14e4:</code> 获得详细的硬件型号，并下载<a href="https://aur.archlinux.org/packages/b43-firmware/">对应的驱动</a>。关于博通无线网卡，可以查阅 <a href="https://wiki.archlinux.org/index.php/Broadcom_wireless">Wiki</a> 页面 获得更多信息</li>
</ul></li>
</ul>

<h2 id="下载并安装驱动">下载并安装驱动</h2>

<ul>
<li>没网络怎么下载 ❓ 可以下载至安装U盘的根目录，安装时切换至 <code>/run/archiso/bootmnt</code>，即可看到下载的内容，将其拷贝至 <code>/root</code> 解压。</li>
<li>如何来安装驱动 ❓ <a href="https://www.cnblogs.com/clouds008/p/7460928.html">更多参考</a> 在上一步解压完成后，会得到一个 <code>.o</code> 结尾的问题，执行 <code>b43-fwcutter -w /lib/firmware xxx.o</code> 即可完成安装。</li>

<li><p>安装后怎么启动 ❓ <a href="http://linuxwireless.sipsolutions.net/en/users/Drivers/b43/">更多参考</a> 卸载之前的驱动，然后再加载新安装的驱动。</p>

<ul>
<li><p>卸载旧驱动（如果你知道你正在使用的驱动名称的话，只需执行对应的命令即可）</p>

<pre><code class="language-bash">modprobe -r b43 bcma
modprobe -r brcmsmac bcma
modprobe -r wl
</code></pre></li>

<li><p>加载新驱动（只需执行对应的驱动命令即可）</p>

<pre><code class="language-bash">modprobe b43
modprobe brcmsmac
modprobe wl
</code></pre></li>
</ul></li>

<li><p>安装完成后可以通过 <code>ip link</code> 查看是否有新增加的网络接口信息。</p></li>
</ul>

<h2 id="安装完成后的联网过程">安装完成后的联网过程</h2>

<blockquote>
<p>此部分内容主要参考了 <a href="https://linux.cn/article-4015-1.html">在命令行中管理 Wifi 连接</a></p>
</blockquote>

<ul>
<li>通过 <code>ip link set &lt;设备名&gt; up</code> 启动接口服务。</li>
<li>可以通过 <code>iw dev &lt;设备名&gt; scan | less</code> 扫描附近网络。</li>
<li>联网（方式 1）无加密网络
<code>bash
iw dev &lt;设备名&gt; connect &lt;网络 SSID&gt;
</code></li>
<li>联网（方式 2）WEP 加密
<code>bash
iw dev &lt;设备名&gt; connect &lt;网络 SSID&gt; key 0:&lt;WEP密钥&gt;
</code></li>

<li><p>联网（方式 3）WPA/WPA2 加密（现在最常见）</p>

<ul>
<li><code>vim /etc/wpasupplicant/wpa_supplicant.conf</code> 编辑文件（其实放在别的位置也行），增加如下内容（注意包含引号）：
<code>
network={
ssid=&quot;&lt;网络 SSID&gt;&quot;
psk=&quot;&lt;密码&gt;&quot;
priority=1
}
</code></li>
<li><code>wpa_supplicant -i &lt;设备名&gt; -c /etc/wpa_supplicant/wpa_supplicant.conf &amp;</code> 后台启动网络连接</li>
</ul></li>

<li><p>获取 IP：<code>dhcpcd &lt;设备名&gt;</code> 自动获取 IP 地址</p></li>

<li><p>测试网络：<code>ping hiwangzi.com</code> 测试网络连接是否正常~</p></li>
</ul>


		<div style="margin-top: 50px;">
<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "zill" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

	</div>

	<div class="pagination">
		<a href="/about/" class="left arrow">&#8592;</a>
		<a href="/2018/05/08/difference-between-if-a-b-0-and-if-a-b/" class="right arrow">&#8594;</a>

		<a href="#" class="top">Top</a>
	</div>
</main>


        		<footer>
			<span>
			&copy; <time datetime="2019-04-17 19:43:57.730981 &#43;0800 CST m=&#43;0.127369211">2019</time> zill057. Made with <a href='https://gohugo.io'>Hugo</a> using the <a href='https://github.com/EmielH/tale-hugo/'>Tale</a> theme.
			</span>
		</footer>

    </body>
</html>
